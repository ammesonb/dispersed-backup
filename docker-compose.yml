dev: &dev
  build: .
  volumes:
    - ./:/go/src/github.com/ammesonb/dispersed-backup
  environment:
    - BUILDKITE_AGENT_ACCESS_TOKEN
    - BUILDKITE_JOB_ID
    - BUILDKITE_BUILD_ID
    - BUILDKITE_BUILD_NUMBER
    - GOPATH=/go/
  working_dir: /go/src/github.com/ammesonb/dispersed-backup

ci: &ci
  <<: *dev
  volumes:
    - /usr/bin/buildkite-agent:/usr/bin/buildkite-agent
  entrypoint: "scripts/entry.sh"


lint: &lint
  <<: *dev
  command: ["scripts/entry.sh", "lint"]

lint-ci:
  <<: *lint
  <<: *ci

test: &test
  <<: *dev
  command: ["scripts/entry.sh", "test"]

test-ci:
  <<: *test
  <<: *ci

build: &build
  <<: *dev
  command: ["go", "build"]

build-ci:
  <<: *ci
  <<: *build
